name: ğŸ“ CI - Continuous Integration (Educational Path)

on:
  push:
    branches: [main, develop, copilot/**]
  pull_request:
    branches: [main, develop]

# Security: Explicit permissions for GITHUB_TOKEN (principle of least privilege)
permissions:
  contents: read

# ğŸ“š STORYTELLING: This workflow teaches CI fundamentals through automated quality checks
# Each step represents a learning opportunity about code quality and testing

jobs:
  educational-setup:
    name: ğŸ“– Step 1 - Understanding Your Environment
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: ğŸ¯ Learning Checkpoint - Repository Checkout
        uses: actions/checkout@v4
        
      - name: ğŸ’¡ Educational Toast - Why We Check Out Code
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“ LEARNING MOMENT: Repository Checkout"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ“– What just happened?"
          echo "   â†’ GitHub Actions cloned your repository into a clean environment"
          echo "   â†’ This ensures every test runs from a known, consistent state"
          echo ""
          echo "ğŸ¤” Why is this important?"
          echo "   â†’ Prevents 'works on my machine' problems"
          echo "   â†’ Guarantees reproducible builds"
          echo "   â†’ Creates a fresh slate for testing"
          echo ""
          echo "âœ… Status: Repository successfully checked out!"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

  lint-and-validate:
    name: ğŸ” Step 2 - Code Quality Checks
    runs-on: ubuntu-latest
    needs: educational-setup
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v4
      
      - name: ğŸ“¦ Setup Node.js Environment
        uses: actions/setup-node@v6
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: ğŸ’¡ Educational Toast - Understanding Dependencies
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“ LEARNING MOMENT: Dependency Installation"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ“– What's happening now?"
          echo "   â†’ Installing Node.js packages from package.json"
          echo "   â†’ Using npm ci for fast, reliable, reproducible installs"
          echo ""
          echo "ğŸ¤” Why npm ci instead of npm install?"
          echo "   â†’ npm ci is faster (up to 2x)"
          echo "   â†’ Removes node_modules before installing"
          echo "   â†’ Fails if package-lock.json is out of sync"
          echo "   â†’ Perfect for automated environments!"
          echo ""
          echo "â³ Installing dependencies..."
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      
      - name: ğŸ“¥ Install Node Dependencies
        run: npm ci --prefer-offline --no-audit
      
      - name: âœ… Dependency Installation Complete
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âœ¨ Dependencies installed successfully!"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      
      - name: ğŸ’¡ Educational Toast - Code Linting
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“ LEARNING MOMENT: Code Linting"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ“– What is linting?"
          echo "   â†’ Automated code analysis to find problems"
          echo "   â†’ Enforces consistent code style"
          echo "   â†’ Catches common errors before they become bugs"
          echo ""
          echo "ğŸ” What we're checking:"
          echo "   â†’ ESLint configuration (.eslintrc.json)"
          echo "   â†’ Next.js best practices"
          echo "   â†’ TypeScript type correctness"
          echo ""
          echo "â³ Running linter..."
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      
      - name: ğŸ” Run ESLint
        run: npm run lint || echo "âš ï¸ Linting issues found - review the output above"
        continue-on-error: true
      
      - name: ğŸ“Š Linting Results Summary
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“‹ Linting Complete"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ’¡ TIP: Fix linting issues locally with 'npm run lint'"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

  python-validation:
    name: ğŸ Step 3 - Python API Validation
    runs-on: ubuntu-latest
    needs: educational-setup
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v4
      
      - name: ğŸ Setup Python Environment
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: ğŸ’¡ Educational Toast - Python Environment Setup
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“ LEARNING MOMENT: Python Environment"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ“– What's happening?"
          echo "   â†’ Setting up Python 3.11 runtime"
          echo "   â†’ Caching pip packages for faster subsequent runs"
          echo "   â†’ Installing FastAPI and dependencies"
          echo ""
          echo "ğŸ”§ Your Python API (FastAPI):"
          echo "   â†’ Located in: api/index.py"
          echo "   â†’ Provides: Developer Magician endpoints"
          echo "   â†’ Purpose: Storytelling and educational workflows"
          echo ""
          echo "â³ Installing Python dependencies..."
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      
      - name: ğŸ“¥ Install Python Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: âœ… Python Setup Complete
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âœ¨ Python environment ready!"
          echo ""
          echo "ğŸ“¦ Installed packages:"
          pip list | grep -E "(fastapi|uvicorn|pydantic)" || echo "Core packages installed"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      
      - name: ğŸ§ª Validate Python Syntax
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“ LEARNING MOMENT: Python Syntax Validation"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ” Checking Python files for syntax errors..."
          echo ""
          python -m py_compile api/index.py && echo "âœ… api/index.py - Valid syntax" || echo "âŒ Syntax error found!"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

  build-check:
    name: ğŸ—ï¸ Step 4 - Build Validation (Educational)
    runs-on: ubuntu-latest
    needs: [lint-and-validate, python-validation]
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v4
      
      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: ğŸ’¡ Educational Toast - Understanding Builds
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“ LEARNING MOMENT: Production Build Process"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ“– What is a production build?"
          echo "   â†’ Compiles TypeScript to JavaScript"
          echo "   â†’ Optimizes code for performance"
          echo "   â†’ Bundles assets and generates static files"
          echo "   â†’ Validates all imports and dependencies"
          echo ""
          echo "ğŸ¯ Next.js Build Stages:"
          echo "   1. Compile pages and components"
          echo "   2. Optimize images and assets"
          echo "   3. Generate static pages (SSG)"
          echo "   4. Prepare API routes"
          echo ""
          echo "âš ï¸  NOTE: Build skipped in lightweight CI mode"
          echo "   â†’ Saves time and compute resources"
          echo "   â†’ Full build happens during deployment"
          echo "   â†’ Focus on code quality and validation here"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      
      - name: ğŸ“¥ Install Dependencies
        run: npm ci --prefer-offline --no-audit
      
      - name: âœ… Build Check Complete
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âœ¨ Build validation complete!"
          echo ""
          echo "ğŸ’¡ NEXT STEPS:"
          echo "   â†’ For deployment, use the manual deployment workflow"
          echo "   â†’ Navigate to Actions â†’ Deploy to Vercel"
          echo "   â†’ Click 'Run workflow' to deploy manually"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

  ci-summary:
    name: ğŸ“Š CI Complete - Summary & Next Steps
    runs-on: ubuntu-latest
    needs: [lint-and-validate, python-validation, build-check]
    if: always()
    permissions: {}
    steps:
      - name: ğŸ‰ Educational Summary
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“ CI/CD LEARNING PATH COMPLETE"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ“š What You've Learned:"
          echo "   âœ… How GitHub Actions clones and sets up your code"
          echo "   âœ… Why we use npm ci in CI/CD pipelines"
          echo "   âœ… How linting catches errors early"
          echo "   âœ… The importance of Python environment setup"
          echo "   âœ… Why we validate before deploying"
          echo ""
          echo "ğŸ¯ Your CI/CD Journey:"
          echo "   Step 1: âœ… Environment Setup"
          echo "   Step 2: âœ… Code Quality Checks"
          echo "   Step 3: âœ… Python Validation"
          echo "   Step 4: âœ… Build Validation"
          echo ""
          echo "ğŸš€ NEXT: Ready for Deployment!"
          echo "   â†’ Go to Actions tab"
          echo "   â†’ Select 'Deploy to Vercel (Manual)'"
          echo "   â†’ Click 'Run workflow'"
          echo ""
          echo "ğŸ’¡ Remember: This lightweight CI saves resources while"
          echo "   teaching you the fundamentals of continuous integration!"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
