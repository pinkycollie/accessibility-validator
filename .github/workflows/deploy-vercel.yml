name: ğŸš€ Deploy to Vercel (Manual)

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Deployment Environment'
        required: true
        default: 'production'
        type: choice
        options:
          - production
          - preview
      reason:
        description: 'Deployment Reason (optional)'
        required: false
        type: string

# Security: Explicit permissions for GITHUB_TOKEN (principle of least privilege)
permissions:
  contents: read

# ğŸ“š STORYTELLING: Manual deployment puts YOU in control
# This workflow teaches deployment concepts while giving you full control over when to deploy

jobs:
  pre-deployment-check:
    name: ğŸ” Pre-Deployment Education & Validation
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v4
      
      - name: ğŸ“ Educational Toast - Understanding Deployment
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“ LEARNING MOMENT: What is Deployment?"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ“– Deployment Process:"
          echo "   â†’ Takes your code from GitHub"
          echo "   â†’ Builds it into optimized production assets"
          echo "   â†’ Publishes it to a live server (Vercel)"
          echo "   â†’ Makes it accessible to users worldwide"
          echo ""
          echo "ğŸ¯ You chose: ${{ inputs.environment }} deployment"
          echo "ğŸ“ Reason: ${{ inputs.reason || 'Manual deployment triggered' }}"
          echo ""
          echo "ğŸ” Why Manual Deployment?"
          echo "   â†’ Full control over deployment timing"
          echo "   â†’ Review changes before going live"
          echo "   â†’ Prevents accidental production deploys"
          echo "   â†’ Educational: Learn each step deliberately"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      
      - name: ğŸ“Š Pre-Deployment Status Check
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ” Checking Deployment Prerequisites..."
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ“¦ Repository Info:"
          echo "   Branch: ${{ github.ref_name }}"
          echo "   Commit: ${{ github.sha }}"
          echo "   Actor: ${{ github.actor }}"
          echo ""
          echo "âœ… Pre-deployment checks complete!"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

  check-secrets:
    name: ğŸ” Verify Deployment Secrets
    runs-on: ubuntu-latest
    permissions: {}
    outputs:
      has_secrets: ${{ steps.check.outputs.has_secrets }}
    steps:
      - name: ğŸ” Check for Vercel Secrets
        id: check
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“ LEARNING MOMENT: Understanding Secrets"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ” What are GitHub Secrets?"
          echo "   â†’ Encrypted environment variables"
          echo "   â†’ Store sensitive data like API keys"
          echo "   â†’ Never exposed in logs or commits"
          echo "   â†’ Configured in: Settings â†’ Secrets â†’ Actions"
          echo ""
          echo "ğŸ” Required Secrets for Vercel Deployment:"
          echo "   â€¢ VERCEL_TOKEN - Your Vercel authentication token"
          echo "   â€¢ VERCEL_ORG_ID - Your Vercel organization ID"
          echo "   â€¢ VERCEL_PROJECT_ID - Your Vercel project ID"
          echo ""
          
          # Check if secrets are available (without exposing them)
          if [ -z "${{ secrets.VERCEL_TOKEN }}" ]; then
            echo "âš ï¸  VERCEL_TOKEN not found"
            echo "has_secrets=false" >> $GITHUB_OUTPUT
          elif [ -z "${{ secrets.VERCEL_ORG_ID }}" ]; then
            echo "âš ï¸  VERCEL_ORG_ID not found"
            echo "has_secrets=false" >> $GITHUB_OUTPUT
          elif [ -z "${{ secrets.VERCEL_PROJECT_ID }}" ]; then
            echo "âš ï¸  VERCEL_PROJECT_ID not found"
            echo "has_secrets=false" >> $GITHUB_OUTPUT
          else
            echo "âœ… All required secrets are configured!"
            echo "has_secrets=true" >> $GITHUB_OUTPUT
          fi
          
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      
      - name: ğŸ“– How to Configure Secrets (If Missing)
        if: steps.check.outputs.has_secrets == 'false'
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“š HOW TO: Configure Vercel Secrets"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ”§ Step-by-Step Guide:"
          echo ""
          echo "1ï¸âƒ£  Get your Vercel Token:"
          echo "   â†’ Go to: https://vercel.com/account/tokens"
          echo "   â†’ Click 'Create Token'"
          echo "   â†’ Name it 'GitHub Actions'"
          echo "   â†’ Copy the token"
          echo ""
          echo "2ï¸âƒ£  Get your Project IDs:"
          echo "   â†’ Go to your Vercel project settings"
          echo "   â†’ Find 'Project ID' and 'Org ID'"
          echo "   â†’ Copy both values"
          echo ""
          echo "3ï¸âƒ£  Add to GitHub Secrets:"
          echo "   â†’ Go to: GitHub repo â†’ Settings â†’ Secrets â†’ Actions"
          echo "   â†’ Click 'New repository secret'"
          echo "   â†’ Add each secret with exact names shown above"
          echo ""
          echo "4ï¸âƒ£  Re-run this workflow!"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

  deploy:
    name: ğŸš€ Deploy to Vercel
    runs-on: ubuntu-latest
    needs: [pre-deployment-check, check-secrets]
    if: needs.check-secrets.outputs.has_secrets == 'true'
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v4
      
      - name: ğŸ“ Educational Toast - Deployment Process
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“ LEARNING MOMENT: The Deployment Pipeline"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ“¦ What's happening now?"
          echo "   1. â¬‡ï¸  Download your code to Vercel's servers"
          echo "   2. ğŸ“¥ Install all dependencies (npm + pip)"
          echo "   3. ğŸ—ï¸  Build Next.js frontend"
          echo "   4. ğŸ Package FastAPI as serverless functions"
          echo "   5. ğŸŒ Deploy to global CDN"
          echo "   6. âœ… Verify deployment health"
          echo ""
          echo "â±ï¸  Typical deployment time: 2-3 minutes"
          echo "ğŸŒ Your app will be available at: [your-project].vercel.app"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      
      - name: ğŸš€ Deploy to Vercel
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          vercel-args: ${{ inputs.environment == 'production' && '--prod' || '' }}
          working-directory: ./
      
      - name: ğŸ‰ Deployment Success!
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âœ¨ DEPLOYMENT COMPLETE!"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ¯ Environment: ${{ inputs.environment }}"
          echo "ğŸ“ Reason: ${{ inputs.reason || 'Manual deployment' }}"
          echo ""
          echo "ğŸŒ Your app is now live!"
          echo ""
          echo "ğŸ” Next Steps:"
          echo "   1. Check your Vercel dashboard for the deployment URL"
          echo "   2. Test your application endpoints"
          echo "   3. Monitor for any errors in Vercel logs"
          echo "   4. Share with users! ğŸŠ"
          echo ""
          echo "ğŸ’¡ Pro Tip: Use preview deployments to test changes"
          echo "   before deploying to production!"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

  deployment-skipped:
    name: âš ï¸ Deployment Skipped - Secrets Missing
    runs-on: ubuntu-latest
    needs: check-secrets
    if: needs.check-secrets.outputs.has_secrets == 'false'
    permissions: {}
    steps:
      - name: ğŸ“š Educational Guidance
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âš ï¸  DEPLOYMENT SKIPPED"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ” Reason: Required secrets are not configured"
          echo ""
          echo "ğŸ“ LEARNING MOMENT:"
          echo "   This is a SAFETY FEATURE, not an error!"
          echo "   â†’ Prevents failed deployments"
          echo "   â†’ Teaches you about secret management"
          echo "   â†’ Guides you to proper configuration"
          echo ""
          echo "ğŸ“– Why secrets matter:"
          echo "   â€¢ Keep your API keys secure"
          echo "   â€¢ Prevent unauthorized access"
          echo "   â€¢ Enable secure CI/CD automation"
          echo "   â€¢ Industry best practice"
          echo ""
          echo "âœ… Action Required:"
          echo "   â†’ Review the 'check-secrets' job above"
          echo "   â†’ Follow the step-by-step guide"
          echo "   â†’ Configure missing secrets"
          echo "   â†’ Re-run this workflow"
          echo ""
          echo "ğŸ’¡ This educational approach ensures you understand"
          echo "   deployment security before automating it!"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

  post-deployment:
    name: ğŸ“Š Post-Deployment Summary
    runs-on: ubuntu-latest
    needs: [deploy]
    if: always() && needs.check-secrets.outputs.has_secrets == 'true'
    permissions: {}
    steps:
      - name: ğŸ“ Educational Wrap-Up
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“ DEPLOYMENT LEARNING PATH COMPLETE"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ“š What You Learned:"
          echo "   âœ… Manual deployment gives you control"
          echo "   âœ… Secrets keep your credentials secure"
          echo "   âœ… Vercel handles the deployment complexity"
          echo "   âœ… Production vs preview environments"
          echo ""
          echo "ğŸ¯ Deployment Journey:"
          echo "   Step 1: âœ… Pre-deployment validation"
          echo "   Step 2: âœ… Secret verification"
          echo "   Step 3: âœ… Deployment execution"
          echo "   Step 4: âœ… Post-deployment summary"
          echo ""
          echo "ğŸš€ CONGRATULATIONS!"
          echo "   You've successfully completed a manual deployment!"
          echo ""
          echo "ğŸ’¡ Next Time:"
          echo "   â†’ Experiment with preview deployments"
          echo "   â†’ Try different branches"
          echo "   â†’ Monitor Vercel logs for insights"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
